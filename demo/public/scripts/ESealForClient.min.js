function ESeaL_ClientSignByHash(a,b,c,d){if(""==a||""==b)return void alert("input error!");if(null!=c&&""!=c)return void VerifyUserPIN(b,c,function(e){var f=!1;if(f=e.retVal,!f)return void alert("密码输入错误");jsonStr=a;var g=$.parseJSON(jsonStr);digestMessageArray=null,digestMessageArray=new Array,cur_Sign_index=0;for(var h=0;h<g.digestMessages.length;h++){var i={};i.signUniqueId=g.digestMessages[h].signUniqueId,i.fileUniqueId=g.digestMessages[h].fileUniqueId,digestMessageArray[h]=i,ESeaL_SignHashData(b,c,g.digestMessages[h].hashData,function(a){if(""==a.retVal)return void alert("passwd error");if(digestMessageArray[cur_Sign_index].clientSignData=a.retVal,cur_Sign_index++,cur_Sign_index==g.digestMessages.length){var b={};b.digestMessages=digestMessageArray;var c={retVal:$.toJSON(b),ctx:ctx};d(c)}})}});jsonStr=a;var e=$.parseJSON(jsonStr);digestMessageArray=null,digestMessageArray=new Array,cur_Sign_index=0;for(var f=0;f<e.digestMessages.length;f++){var g={};g.signUniqueId=e.digestMessages[f].signUniqueId,g.fileUniqueId=e.digestMessages[f].fileUniqueId,digestMessageArray[f]=g,ESeaL_SignHashData(b,c,e.digestMessages[f].hashData,function(a){if(""==a.retVal)return void alert("passwd error");if(digestMessageArray[cur_Sign_index].clientSignData=a.retVal,cur_Sign_index++,cur_Sign_index==e.digestMessages.length){var b={};b.digestMessages=digestMessageArray;var c={retVal:$.toJSON(b),ctx:ctx};d(c)}})}}function ESeaL_Login(a,b,c){VerifyUserPIN(cur_cert_id,b,c)}function ESeaL_GetUserCert(a,b){GetSignCert(a,b)}function ESeaL_GetStampPic(a,b){if(ctx=null,!$checkBrowserISIE()){var c=!1,d=window.navigator.userAgent.match(/Chrome\/(\d+)\./);if(d&&d[1]&&parseInt(d[1],10)>=42&&(c=!0),c&&!$_$WebSocketConnectState)return void alert("ESeal-WebSocket connect error!")}return null!=$_$ClientSign_PDFClientLogin?$_$ClientSign_PDFClientLogin.ESeaL_GetStampPic(a,b,ctx):$myErrorRtnFunc("",b,ctx)}function ESeaL_SignHashData(a,b,c,d){var e=null;GetSignCert(a,function(b){if(e=b.retVal,null!=e&&0!=e.length){var f=3,g=null;GetCertBasicinfo(e,f,function(b){if(g=b.retVal,null!=g&&0!=g.length){var e=4;"RSA"!=g&&(e=1),SignHashData(a,c,e,d)}})}})}function $XTXAlert(a){"function"==typeof $_$XTXAlert?$_$XTXAlert(a):alert(a)}function $myOKRtnFunc(a,b,c){if("function"==typeof b){var d={retVal:a,ctx:c};b(d)}return a}function CreateAppObject_PDFClientLogin(){var a=$LoadControl("A9A51080-2FC6-40D0-9491-7E641F39C70D","PDFClientLogin",null);if(!a)return null;var b=new Object;return b.ESeaL_GetUserCert=function(a,b,c){var d;return d=PDFClientLogin.GetUserCert(a),$myOKRtnFunc(d,b,c)},b.ESeaL_GetStampPic=function(a,b,c){var d;return d=PDFClientLogin.GetUserEseal(a),$myOKRtnFunc(d,b,c)},b.ESeaL_SignHashData=function(a,b,c,d,e){var f;return f=PDFClientLogin.Sign(a,c),$myOKRtnFunc(f,d,e)},b}function CreateWebSocketObject_PDFClient(){var a=new Object;return a.ws_host="ws://127.0.0.1:",a.ws_port_array=["4114","5114","6114","7114","8114"],a.ws_port_use=0,a.ws_obj=null,a.ws_heartbeat_id=0,a.ws_queue_id=0,a.ws_queue_list={},a.ws_queue_ctx={},a.xtx_version="",a.load_websocket=function(){if(a.ws_port_use>a.ws_port_array.length)return a.ws_port_use=0,!1;var b=a.ws_host+a.ws_port_array[a.ws_port_use]+"/";try{a.ws_obj=new WebSocket(b)}catch(c){return console.log(c),!1}return a.ws_obj.onopen=function(b){clearInterval(a.ws_heartbeat_id),a.callMethod("ESeaL_GetGetVersion",function(b){a.xtx_version=b.retVal}),a.ws_heartbeat_id=setInterval(function(){a.callMethod("ESeaL_GetGetVersion",function(a){})},2e4),$_$WebSocketConnectState=!0},a.ws_obj.onclose=function(a){},a.ws_obj.onmessage=function(b){var c=JSON.parse(b.data);if("undefined"!=typeof c.call_cmd_id&&"function"==typeof a.ws_queue_list[c.call_cmd_id]){var d=a.ws_queue_list[c.call_cmd_id],e=a.ws_queue_ctx[c.call_cmd_id];e=e||{returnType:"string"};var f;f="string"==typeof e.returnType?"bool"==e.returnType?"true"==c.retVal?!0:!1:"number"==e.returnType?Number(c.retVal):c.retVal:c.retVal;var g={retVal:f,ctx:e};d(g),"onUsbkeyChange"!=c.call_cmd_id&&delete a.ws_queue_list[c.call_cmd_id],delete a.ws_queue_ctx[c.call_cmd_id]}},a.ws_obj.onerror=function(b){return a.ws_port_use++,5==a.ws_port_use?null:void a.load_websocket()},!0},a.sendMessage=function(b){a.ws_obj.readyState==WebSocket.OPEN?a.ws_obj.send(JSON.stringify(b)):console.log("Can't connect to ESeal-WebSocket server!")},a.callMethod=function(b,c,d,e,f){a.ws_queue_id++,"function"==typeof c&&(a.ws_queue_list["i_"+a.ws_queue_id]=c,d=d||{},d.returnType=e,a.ws_queue_ctx["i_"+a.ws_queue_id]=d);var g={};if(g.xtx_func_name=b,g.call_cmd_id="i_"+a.ws_queue_id,arguments.length>4)for(var h=1;h<=f.length;h++){var i="param_"+h;g[i]=f[h-1]}a.ws_obj.readyState==WebSocket.OPEN?a.sendMessage(g):a.ws_obj.readyState!=WebSocket.OPEN&&a.ws_obj.readyState!=WebSocket.CONNECTING&&(a.load_websocket(),setTimeout(a.sendMessage(g),500))},a.ESeaL_GetUserCert=function(b,c,d){var e=[b];d=null,returnType=null,a.callMethod("ESeaL_GetUserCert",c,d,returnType,e)},a.ESeaL_GetStampPic=function(b,c,d){var e=[b];d=null,returnType=null,a.callMethod("ESeaL_GetStampPic",c,d,returnType,e)},a.ESeaL_SignHashData=function(b,c,d,e,f){var g=[b,c,d];f=null,returnType=null,a.callMethod("ESeaL_SignHashData",e,f,returnType,g)},a.load_websocket()?a:null}function $LoadControl(CLSID,ctlName,testFuncName){var pluginDiv=document.getElementById("pluginDiv"+ctlName);if(pluginDiv)return!0;pluginDiv=document.createElement("div"),pluginDiv.id="pluginDiv"+ctlName,document.body.appendChild(pluginDiv);try{if($checkBrowserISIE())pluginDiv.innerHTML='<object id="'+ctlName+'" classid="CLSID:'+CLSID+'" codebase="./scripts/PDFSeal.cab" style="HEIGHT:0px; WIDTH:0px"></object>';else{var chromeVersion=window.navigator.userAgent.match(/Chrome\/(\d+)\./);if(chromeVersion&&chromeVersion[1]&&parseInt(chromeVersion[1],10)>=42)return document.body.removeChild(pluginDiv),pluginDiv.innerHTML="",pluginDiv=null,!1;pluginDiv.innerHTML="<embed id="+ctlName+" type=application/x-xtx-axhost clsid={"+CLSID+"} width=0 height=0 />"}return null!=testFuncName&&""!=testFuncName&&void 0==eval(ctlName+"."+testFuncName)?(document.body.removeChild(pluginDiv),pluginDiv.innerHTML="",pluginDiv=null,!1):!0}catch(e){return document.body.removeChild(pluginDiv),pluginDiv.innerHTML="",pluginDiv=null,!1}}function $checkBrowserISIE(){return window.ActiveXObject||"ActiveXObject"in window?!0:!1}var jsonStr=null,digestMessageArray=null,cur_Sign_index=0,$_$WebSocketConnectState=!1,$_$XTXAlert=null,$_$PDFClientLogin_AppObj=null,$_$PDFClientLogin_WebSocketObj=null,$_$ClientSign_PDFClientLogin=null;!function(){return $_$PDFClientLogin_AppObj=CreateAppObject_PDFClientLogin(),null!=$_$PDFClientLogin_AppObj?void($_$ClientSign_PDFClientLogin=$_$PDFClientLogin_AppObj):($_$PDFClientLogin_WebSocketObj=CreateWebSocketObject_PDFClient(),null!=$_$PDFClientLogin_WebSocketObj?void($_$ClientSign_PDFClientLogin=$_$PDFClientLogin_WebSocketObj):($_$ClientSign_PDFClientLogin=null,void alert("��ʼ��ǩ�º��ķ�������!")))}();